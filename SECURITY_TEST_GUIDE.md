# セキュリティテストガイド

このドキュメントは、実装したセキュリティ対策をテストするための包括的なガイドです。

## テスト環境のセットアップ

```bash
# ローカルサーバーの起動
http-server -p 8000

# ブラウザのデベロッパーツールを開く
# Console、Network、Applicationタブを使用してテストを実施
```

## 1. XSS（クロスサイトスクリプティング）テスト

### テストケース1: 基本的なスクリプトインジェクション
各テキスト入力フィールドに以下を入力:
```
<script>alert('XSS')</script>
```

**期待される結果**:
- アラートが表示されない
- 入力がサニタイズされる
- セキュリティログに記録される（開発環境）

### テストケース2: イベントハンドラインジェクション
```
<img src=x onerror=alert('XSS')>
<div onmouseover="alert('XSS')">test</div>
```

**期待される結果**:
- イベントハンドラが実行されない
- HTMLタグが除去される

### テストケース3: JavaScriptプロトコル
```
<a href="javascript:alert('XSS')">click</a>
```

**期待される結果**:
- JavaScriptが実行されない
- javascript:プロトコルが除去される

## 2. SQLインジェクションテスト

### テストケース1: 基本的なSQLインジェクション
```
'; DROP TABLE users; --
' OR '1'='1
```

**期待される結果**:
- 入力がサニタイズされる
- セキュリティログに警告が記録される

### テストケース2: コメント構文
```
admin'--
admin'/*
```

**期待される結果**:
- SQLコメント構文が除去される

## 3. レート制限テスト

### テストケース1: 連続送信
1. フォームを正しく入力
2. 送信ボタンを素早く5回以上クリック

**期待される結果**:
- 3回目以降はレート制限エラー
- エラーメッセージの表示

### テストケース2: ページリロード後の再試行
1. レート制限に達した後、ページをリロード
2. 1分後に再度送信を試みる

**期待される結果**:
- 1分後は正常に送信可能

## 4. CSP（Content Security Policy）テスト

### テストケース1: インラインスクリプト
ブラウザのコンソールで実行:
```javascript
document.body.innerHTML += '<script>alert("CSP test")</script>';
```

**期待される結果**:
- CSPエラーがコンソールに表示される
- スクリプトが実行されない

### テストケース2: 外部リソース読み込み
```javascript
fetch('https://evil-site.com/api').then(r => console.log(r));
```

**期待される結果**:
- CSPによりブロックされる
- コンソールにCSP違反が記録される

## 5. エラーハンドリングテスト

### テストケース1: ネットワークエラー
1. デベロッパーツールのNetworkタブでオフラインモードに設定
2. フォームを送信

**期待される結果**:
- 開発環境: 詳細なエラー情報表示
- 本番環境: 汎用的なエラーメッセージ

### テストケース2: APIエラー
config.jsのWebhook URLを無効なURLに変更して送信

**期待される結果**:
- 適切なエラーメッセージ
- セキュリティログに記録

## 6. セキュリティログテスト

### ログの確認方法
ブラウザのコンソールで実行:
```javascript
// セキュリティイベントの確認
SecurityLogger.getEvents();

// 特定のイベントタイプのみ表示
SecurityLogger.getEvents('xss_attempt');

// ログのクリア
SecurityLogger.clearEvents();
```

## 7. 入力検証テスト

### テストケース1: 必須フィールド
1. 店舗を選択せずに送信
2. 評価を選択せずに送信

**期待される結果**:
- エラーメッセージの表示
- エラー箇所へのスクロール

### テストケース2: メールアドレス検証
無効なメールアドレスを入力:
```
invalid-email
@example.com
test@
```

**期待される結果**:
- バリデーションエラー（サーバーサイド実装時）

## 8. 開発環境特有の機能テスト

### デバッグ情報の確認
1. localhost:8000でアプリケーションを開く
2. フォームを送信
3. コンソールで詳細ログを確認

**確認項目**:
- APIレスポンスの詳細
- エラースタックトレース
- セキュリティイベント

## テスト結果の記録

テスト実施時は以下の情報を記録:

| テストケース | 実施日 | 結果 | 備考 |
|------------|-------|------|------|
| XSS基本 | | | |
| XSSイベント | | | |
| SQLインジェクション | | | |
| レート制限 | | | |
| CSP | | | |
| エラーハンドリング | | | |

## 自動テストの推奨

将来的には以下のツールでの自動化を推奨:
- Cypress: E2Eテスト
- Jest: ユニットテスト
- OWASP ZAP: セキュリティスキャン

## トラブルシューティング

### CSPエラーが表示される場合
1. index.htmlのCSPメタタグを確認
2. 必要なドメインが許可されているか確認

### セキュリティログが記録されない場合
1. security-logger.jsが読み込まれているか確認
2. ブラウザのローカルストレージを確認

### レート制限が機能しない場合
1. ローカルストレージが有効か確認
2. ブラウザの時刻設定を確認